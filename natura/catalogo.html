<!doctype html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta http-equiv="x-dns-prefetch-control" content="on" />
  <title>Irenismb Stock Natura | Cat√°logo en Santa Marta | Compra por WhatsApp</title>
  <meta name="description" content="Cat√°logo Natura en Santa Marta: fragancias, cuidado personal, maquillaje y m√°s. Compra f√°cil por WhatsApp." />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet=-1,max-video-preview=-1" />
  <meta name="theme-color" content="#0b0f14" />
  <meta name="format-detection" content="telephone=no" />
  <link rel="canonical" href="https://irenismb.github.io/stock/natura/catalogo.html" />
  <link rel="alternate" hreflang="es-CO" href="https://irenismb.github.io/stock/natura/catalogo.html" />

  <!-- ‚úÖ Estructura esperada:
       - natura/logos
       - natura/imagenes_de_productos
  -->

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="logos/logo_empresa.png" />
  <link rel="icon" type="image/webp" href="logos/logo_empresa.webp" />
  <link rel="apple-touch-icon" href="logos/logo_empresa.png" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://irenismb.github.io/stock/natura/catalogo.html" />
  <meta property="og:title" content="Irenismb Stock Natura | Cat√°logo con compra por WhatsApp" />
  <meta property="og:description" content="Explora el cat√°logo Natura en Santa Marta. Compra f√°cil por WhatsApp." />
  <meta property="og:image" content="https://irenismb.github.io/stock/natura/logos/logo_empresa.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="800" />
  <meta property="og:image:height" content="800" />
  <meta property="og:site_name" content="Irenismb Stock Natura" />
  <meta property="og:locale" content="es_CO" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Irenismb Stock Natura | Cat√°logo" />
  <meta name="twitter:description" content="Cat√°logo Natura en Santa Marta. Compra f√°cil por WhatsApp." />
  <meta name="twitter:image" content="https://irenismb.github.io/stock/natura/logos/logo_empresa.png" />

  <link rel="dns-prefetch" href="//web.whatsapp.com" />
  <link rel="preconnect" href="https://web.whatsapp.com" crossorigin />
  <link rel="preconnect" href="https://api.github.com" crossorigin />

  <!-- Preload del logo PNG (fallback garantizado) -->
  <link rel="preload" as="image" href="logos/logo_empresa.png" fetchpriority="high" />
  <!-- Preload del placeholder por defecto -->
  <link rel="preload" as="image" href="logos/suplente.webp" type="image/webp" fetchpriority="high" />
  <link rel="preload" as="image" href="logos/suplente.png" type="image/png" fetchpriority="high" />

  <style>
    :root{
      --bg:#0b0f14;
      --card:#121826;
      --txt:#e7edf5;
      --mut:#a9b4c2;
      --acc:#20c997;
      --br:14px;
      --line:#22304a;
      --focus:#60a5fa;
      --pill:#0e1524;
      --danger:#ef4444;

      --social-size: clamp(26px, 8.5vw, 38px);
      --social-gap: clamp(3px, 1.6vw, 10px);

      --count-blink:#facc15;
      --count-blink-2:#fb7185;
    }

    *{box-sizing:border-box}
    html,body{max-width:100%;overflow-x:hidden}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#0b0f14,#0c1220);
      color:var(--txt);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto}

    .site-header{ padding:16px 16px 10px; }
    .site-header-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      border:1px solid var(--line);
      background:rgba(18,24,38,.55);
      border-radius:18px;
      padding:12px 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:260px;
    }
    .brand img{
      width:52px;height:52px;border-radius:16px;
      object-fit:cover;
      background:#0b1220;
      border:1px solid rgba(255,255,255,.06);
      display:block;
    }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .brand p{
      margin:3px 0 0;
      font-size:12.5px;
      color:var(--mut);
      line-height:1.35;
    }
    .badge{
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#a3e635);
      padding:6px 14px;
      font-size:12px;
      color:#052e16;
      font-weight:800;
      white-space:nowrap;
    }

    header .intro{ padding:14px 16px 8px; }
    .about-card{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(18,24,38,.55);
      padding:12px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:12px;
    }
    .about-text{
      margin:0;
      font-size:12px;
      line-height:1.35;
    }
    .about-toggle{
      align-self:flex-start;
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
    }

    @media (max-width:768px){
      .about-text{ font-size:11px; }
      .about-card.about-collapsed .about-text{
        display:-webkit-box;
        -webkit-box-orient:vertical;
        -webkit-line-clamp:2;
        overflow:hidden;
      }
      #aboutText{ text-align:center; }
      .about-toggle{ align-self:center; }
    }
    @media (min-width:769px){
      .about-toggle{ display:none; }
    }

    .bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    input,select,button{
      border-radius:12px;border:1px solid #263246;background:var(--pill);
      color:var(--txt);padding:10px 12px;font-size:14px
    }
    input{flex:1;min-width:220px}
    button{cursor:pointer}
    button:focus-visible, input:focus-visible, select:focus-visible{
      outline:2px solid var(--focus);
      outline-offset:2px;
    }

    .search-wrap{
      position:relative;
      flex:1 1 220px;
      min-width:220px;
      --marquee-distance: 0px;
      --marquee-duration: 14s;
    }
    .search-wrap input{ width:100%; }
    .search-ticker{
      position:absolute;
      inset:0;
      border-radius:12px;
      display:flex;
      align-items:center;
      padding:10px 12px;
      overflow:hidden;
      pointer-events:none;
      z-index:2;
      opacity:0;
      transition:opacity .15s ease;
      color:var(--mut);
    }
    .search-wrap.show-ticker .search-ticker{ opacity:1; }
    .search-wrap.show-ticker input::placeholder{ color:transparent; }

    .ticker-inner{
      display:flex;
      width:max-content;
      will-change:transform;
      transform:translate3d(0,0,0);
      animation: marquee var(--marquee-duration) linear infinite;
    }
    .ticker-seq{
      display:flex;
      align-items:center;
      width:max-content;
    }
    .ticker-item{
      white-space:nowrap;
      padding-right:48px;
    }
    @keyframes marquee{
      from{ transform: translate3d(0,0,0); }
      to{ transform: translate3d(calc(-1 * var(--marquee-distance)),0,0); }
    }
    @media (prefers-reduced-motion: reduce){
      .ticker-inner{ animation:none; transform:none; }
    }

    .btn-acc{
      background:linear-gradient(90deg,#20c997,#2dd4bf);
      border:none;color:#04120d;font-weight:900;
    }
    .btn-acc.in-cart{
      background: linear-gradient(90deg,#f59e0b,#f97316);
      color:#1f1300;
    }
    .btn-ghost{
      background:transparent;
      border:1px solid #2a3b5c;
      color:var(--txt);
      font-weight:800;
    }
    .btn-danger{
      background:transparent;
      border:1px solid rgba(239,68,68,.55);
      color:#fecaca;
      font-weight:900;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .social-icons{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:var(--social-gap);
      flex-wrap:nowrap;
      margin-top:12px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(18,24,38,.45);
      width:100%;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .social-icons::-webkit-scrollbar{ display:none; }
    .social-icons a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:var(--social-size);
      height:var(--social-size);
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(11,18,32,.35);
      text-decoration:none;
      flex:0 0 auto;
    }
    .social-icons a:hover{border-color:#3b82f6}
    .social-icons img{
      width:calc(var(--social-size) * 0.58);
      height:calc(var(--social-size) * 0.58);
      object-fit:contain;
      border-radius:999px;
      display:block;
    }
    .social-icons svg{
      width:calc(var(--social-size) * 0.58);
      height:calc(var(--social-size) * 0.58);
      fill:var(--txt);
      display:block;
    }

    main{max-width:1100px;margin:0 auto;padding:0 16px 20px}
    .topline{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      padding:10px 0 6px;
    }
    .topline.hidden{ display:none; }

    .count{
      font-size:12px;
      color:var(--mut);
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid transparent;
      background:rgba(11,18,32,.18);
      max-width:100%;
    }

    .count-slot{
      display:none;
      width:100%;
    }

    @keyframes countBlink{
      0%, 100%{
        opacity:1;
        transform:translateY(0);
        text-shadow:
          0 0 10px rgba(250,204,21,.55),
          0 0 22px rgba(251,113,133,.35);
        border-color: rgba(250,204,21,.35);
      }
      50%{
        opacity:.28;
        transform:translateY(-.5px);
        text-shadow:
          0 0 2px rgba(250,204,21,.22),
          0 0 8px rgba(251,113,133,.22);
        border-color: rgba(251,113,133,.25);
      }
    }
    .count.search-active{
      color:var(--count-blink);
      font-weight:950;
      background:linear-gradient(90deg, rgba(250,204,21,.14), rgba(251,113,133,.10));
      animation: countBlink 1.15s ease-in-out infinite;
    }
    @media (prefers-reduced-motion: reduce){
      .count.search-active{
        animation:none;
        opacity:1;
      }
    }

    .grid{
      display:grid;
      gap:12px;
      margin-top:12px;
      grid-template-columns:repeat(4, minmax(0, 1fr));
      align-items:stretch; /* ‚úÖ fuerza que todos los items se estiren en altura */
    }
    @media (max-width:1024px){
      .grid{ grid-template-columns:repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width:760px){
      .grid{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width:420px){
      .grid{ grid-template-columns:repeat(3, minmax(0, 1fr)); }
    }

    /* ==========================
       ‚úÖ MEJORA CLAVE (TARJETAS IGUALES + BOTONES ALINEADOS)
       - La tarjeta se estira siempre a la altura de la fila (grid)
       - El bloque de contenido (.pad) ocupa el alto restante
       - Los botones se empujan al fondo (margin-top:auto)
       - Nombre y meta se ‚Äúclamp‚Äù para evitar que unas tarjetas crezcan m√°s que otras
       ========================== */
    .card{
      background:rgba(18,24,38,.92);
      border:1px solid var(--line);
      border-radius:var(--br);
      overflow:hidden;
      display:flex;
      flex-direction:column;

      height:100%;            /* ‚úÖ permite que el estiramiento del grid funcione siempre */
      align-self:stretch;     /* ‚úÖ refuerzo */
      min-height:0;           /* ‚úÖ evita problemas de overflow en flex */

      content-visibility:auto;
      contain-intrinsic-size: 420px 520px;
    }

    /* ‚úÖ LIENZO CUADRADO UNIFORME (ROBUSTO, SIN DEPENDER DE aspect-ratio) */
    .img{
      position:relative;
      width:100%;
      background:#0b1220;
      border-bottom:1px solid var(--line);
      overflow:hidden;
      flex:0 0 auto; /* ‚úÖ evita que el cuadro se deforme */
    }
    .img::before{
      content:"";
      display:block;
      padding-top:100%; /* cuadro 1:1 */
    }
    .img > img{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      max-width:calc(100% - 16px);
      max-height:calc(100% - 16px);
      width:auto;
      height:auto;
      object-fit:contain;
      display:block;
      cursor:zoom-in;
    }

    .pad{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;

      flex:1 1 auto;   /* ‚úÖ ocupa el alto restante para igualar tarjetas */
      min-height:0;    /* ‚úÖ requerido para clamp/overflow correcto en flex */
    }

    .name{
      font-weight:950;margin:0;font-size:15px;line-height:1.25;

      /* ‚úÖ evita que un nombre largo cambie la altura de la tarjeta */
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:2;
      overflow:hidden;
    }

    .meta{
      color:var(--mut);font-size:12px;margin:0;

      /* ‚úÖ evita que meta con m√°s info cambie la altura de la tarjeta */
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:2;
      overflow:hidden;
    }

    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .price{font-weight:950}

    .pill{
      display:inline-block;font-size:11px;padding:4px 8px;border-radius:999px;
      border:1px solid #2a3b5c;color:var(--mut);
      background:rgba(11,18,32,.35);
      white-space:nowrap;
    }

    #cartCount{
      margin-left:8px;
      border-color: rgba(0,0,0,.18);
      background: rgba(255,255,255,.25);
      color:#04120d;
    }
    #cartCount.has-items{
      background: linear-gradient(90deg,#f59e0b,#f97316);
      color:#1f1300;
      border-color: rgba(0,0,0,.25);
    }

    /* ‚úÖ botones siempre alineados al fondo y con mismo alto */
    .actions{
      margin-top:auto;                 /* ‚úÖ empuja los botones al fondo */
      display:grid;
      grid-template-columns:1fr 1fr;   /* ‚úÖ ‚Äúmisma fila‚Äù consistente */
      gap:10px;
      align-items:stretch;
    }
    .actions button{
      width:100%;
      min-height:44px; /* ‚úÖ consistencia visual */
    }

    .cart-modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .cart-modal.open{display:flex}
    .cart-modal-backdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.75);
    }
    .cart-modal-content{
      position:relative;
      z-index:1;
      width:min(640px, 94vw);
      max-height:86vh;
      background:rgba(18,24,38,.98);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:0 28px 70px rgba(0,0,0,.55);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .cart-modal-header{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(11,18,32,.35);
    }
    .cart-modal-title{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:.02em;
    }
    .cart-modal-close{
      width:34px;height:34px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(11,18,32,.35);
      color:var(--txt);
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
    }
    .cart-modal-body{
      padding:12px 14px;
      overflow:auto;
    }
    .cart-empty{
      padding:10px 12px;
      border:1px dashed #2a3b5c;
      border-radius:14px;
      color:var(--mut);
      background:rgba(11,18,32,.25);
      line-height:1.45;
    }
    .cart-item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 10px;
      background:rgba(11,18,32,.28);
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .cart-item-left{
      display:flex;
      align-items:center;
      gap:10px;
      flex:1 1 280px;
      min-width:220px;
    }

    /* ‚úÖ MINIATURA SIN RECORTE */
    .cart-thumb{
      width:46px;
      height:46px;
      border-radius:12px;
      object-fit:contain;
      background:#0b1220;
      border:1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
      cursor:zoom-in;
      display:block;
    }

    .cart-item-main{
      flex:1 1 auto;
      min-width:0;
    }
    .cart-item-name{
      font-weight:950;
      margin:0 0 4px;
      font-size:13.5px;
      line-height:1.25;
    }
    .cart-item-sub{
      margin:0;
      color:var(--mut);
      font-size:12px;
      line-height:1.3;
    }
    .cart-controls{
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(18,24,38,.55);
      border:1px solid #2a3b5c;
      border-radius:999px;
      padding:6px 8px;
    }
    .cart-qty-btn{
      width:32px;height:32px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(11,18,32,.25);
      color:var(--txt);
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
    }
    .cart-qty-btn:disabled{
      opacity:.45;
      cursor:not-allowed;
    }
    .cart-qty{
      min-width:26px;
      text-align:center;
      font-weight:950;
      color:var(--txt);
      font-size:13px;
    }
    .cart-subtotal{
      font-weight:950;
      white-space:nowrap;
      color:var(--txt);
    }
    .cart-remove{
      border-radius:999px;
      padding:9px 12px;
      border:1px solid rgba(239,68,68,.55);
      background:rgba(239,68,68,.10);
      color:#fecaca;
      font-weight:950;
      cursor:pointer;
      white-space:nowrap;
    }
    .cart-modal-footer{
      padding:12px 14px;
      border-top:1px solid var(--line);
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(11,18,32,.35);
    }
    .cart-total{
      font-weight:950;
      color:var(--txt);
    }

    .img-modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10000;
      overflow:hidden;
    }
    .img-modal.open{display:flex}
    .img-modal-backdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.80);
    }
    .img-modal-content{
      position:relative;
      z-index:1;
      width:100vw;
      height:100vh;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .img-modal-content img{
      max-width:100%;
      max-height:100%;
      width:auto;
      height:auto;
      object-fit:contain;
      border-radius:14px;
      background:#000;
      box-shadow:0 22px 60px rgba(0,0,0,.6);
      display:block;
    }
    .img-modal-close{
      position:absolute;
      z-index:2;
      top:10px;
      right:10px;
      width:38px;
      height:38px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(11,18,32,.55);
      color:var(--txt);
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    #btn-cart .btn-cart-label-short{ display:none; }

    @media (max-width:560px){
      .bar{ align-items:stretch; row-gap:8px; }
      .bar .search-wrap{ flex:1 1 100%; min-width:0; }

      .count-slot{
        display:flex;
        justify-content:center;
        align-items:center;
        flex:1 1 100%;
        margin-top:-2px;
      }
      .count.count-mobile{
        display:block;
        width:100%;
        text-align:center;
        margin:0 auto;
      }

      #cat, #brand, #sort, #btn-cart{
        flex:1 1 calc(50% - 5px);
        min-width:0;
      }

      .bar select, .bar button{ min-height:44px; }

      #btn-cart{
        display:flex;
        align-items:center;
        justify-content:center;
        gap:8px;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }

      #btn-cart .btn-cart-label{ display:none; }
      #btn-cart .btn-cart-label-short{ display:inline; }
    }

    @media (max-width:720px){
      .badge{width:100%;text-align:center}
      .site-header-inner{padding:12px}
    }
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto!important;transition:none!important;animation:none!important}
    }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Store",
    "name":"Irenismb Stock Natura",
    "url":"https://irenismb.github.io/stock/natura/catalogo.html",
    "description":"Cat√°logo Natura en Santa Marta. Compra f√°cil por WhatsApp.",
    "telephone":"+57 304 208 8961",
    "address":{
      "@type":"PostalAddress",
      "streetAddress":"Calle 10A #20A-06 barrio Los Almendros",
      "addressLocality":"Santa Marta",
      "addressRegion":"Magdalena",
      "addressCountry":"CO"
    },
    "geo":{
      "@type":"GeoCoordinates",
      "latitude":11.244833370782679,
      "longitude":-74.19066001689564
    },
    "hasMap":"https://maps.google.com/?q=11.244833370782679,-74.19066001689564",
    "areaServed":"Colombia",
    "sameAs":[
      "https://www.facebook.com/marketplace/profile/100084865295132",
      "https://www.instagram.com/irenismb_stocknaturasm",
      "https://www.tiktok.com/@irenismbstocknatura",
      "https://www.youtube.com/@irenismendoza3615",
      "https://www.google.com/search?q=Vendedora+de+productos+de+belleza+Natura+y+Avon+en+Santa+Marta+-+NaturaStock+-+Consultora&stick=H4sIAAAAAAAA_y2MsQrCMBBAJ8XPOARHoaWJXt1KZ10KguM1uS6GO0kTqX6OX2oElwePB2-z3u6qBXkyk8UGPeLx0LSnamGqnTXGco0GnRk_q9uVxbPXSOAZHlF9dknnn4wcAr8JLpRyyS_onirAAgNJIjhTLNz_85DU3Yv1KnMOqfy-HB1A2oUAAAA&hl=es&mat=Ca0DNKJEuZnvElcBTVDHnhCRNO4f76He0gBHXwhbrob3GAaW6TYVDt7oFfRBvX8RXOdAY80UJzgwnY-lM1rJl0_0MhFuTJLig6PjtZcDFw8inJAS7CO2GHXYDb00SMyaaro&authuser=1&sei=HqiKafiVK4ubwbkPgpqnyAI"
    ]
  }
  </script>
  <script type="application/ld+json" id="ld-products">{}</script>
</head>

<body>
  <header class="site-header">
    <div class="wrap site-header-inner">
      <div class="brand">
        <picture>
          <source srcset="logos/logo_empresa.webp" type="image/webp">
          <img src="logos/logo_empresa.png" alt="Logo Irenismb Stock Natura" width="52" height="52" />
        </picture>
        <div>
          <h1>IRENISMB STOCK NATURA</h1>
          <p>Cat√°logo Natura en Santa Marta ‚Ä¢ Compra por WhatsApp</p>
        </div>
      </div>
      <div class="badge">Natura ¬∑ Maquillaje ¬∑ Cuidado personal</div>
    </div>

    <div class="wrap intro">
      <section class="about-card" id="aboutCard" aria-label="Sobre nosotros y contacto">
        <p class="small about-text" id="aboutText">
          Irenismb Stock Natura es una tienda en l√≠nea con punto f√≠sico en Santa Marta especializada en productos Natura, AVON y Esika.
          Te asesoramos por WhatsApp, v√≠a telef√≥nica o de manera presencial en el barrio los Almendros. Direcci√≥n: Calle 10A #20A-06. Tel√©fono: +57 304 208 8961.
          Realizamos env√≠os nacionales e Internacionales.
        </p>
        <button class="btn-ghost about-toggle" id="aboutToggle" type="button"
                aria-expanded="false" aria-controls="aboutText">
          Ver m√°s
        </button>
      </section>

      <div class="social-icons" aria-label="Redes sociales, ubicaci√≥n, WhatsApp y llamada">
        <a href="https://www.facebook.com/marketplace/profile/100084865295132" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
          <img src="logos/facebook.webp" alt="Facebook" loading="lazy" decoding="async" />
        </a>
        <a href="https://www.instagram.com/irenismb_stocknaturasm" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <img src="logos/instagram.webp" alt="Instagram" loading="lazy" decoding="async" />
        </a>
        <a href="https://www.tiktok.com/@irenismbstocknatura" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          <img src="logos/tiktok.webp" alt="TikTok" loading="lazy" decoding="async" />
        </a>
        <a href="https://www.youtube.com/@irenismendoza3615" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
          <img src="logos/youtube.png" alt="YouTube" loading="lazy" decoding="async" />
        </a>
        <a href="https://maps.google.com/?q=11.244833370782679,-74.19066001689564" target="_blank" rel="noopener noreferrer" aria-label="Ubicaci√≥n en Google Maps">
          <img src="logos/maps.webp" alt="Google Maps" loading="lazy" decoding="async" />
        </a>

        <a href="https://www.google.com/search?q=Vendedora+de+productos+de+belleza+Natura+y+Avon+en+Santa+Marta+-+NaturaStock+-+Consultora&stick=H4sIAAAAAAAA_y2MsQrCMBBAJ8XPOARHoaWJXt1KZ10KguM1uS6GO0kTqX6OX2oElwePB2-z3u6qBXkyk8UGPeLx0LSnamGqnTXGco0GnRk_q9uVxbPXSOAZHlF9dknnn4wcAr8JLpRyyS_onirAAgNJIjhTLNz_85DU3Yv1KnMOqfy-HB1A2oUAAAA&hl=es&mat=Ca0DNKJEuZnvElcBTVDHnhCRNO4f76He0gBHXwhbrob3GAaW6TYVDt7oFfRBvX8RXOdAY80UJzgwnY-lM1rJl0_0MhFuTJLig6PjtZcDFw8inJAS7CO2GHXYDb00SMyaaro&authuser=1&sei=HqiKafiVK4ubwbkPgpqnyAI"
           target="_blank" rel="noopener noreferrer" aria-label="Google Business">
          <img src="logos/google_business.webp" alt="Google Business" loading="lazy" decoding="async" />
        </a>

        <a id="waTopLink" href="https://wa.me/573042088961" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
          <img src="logos/whatsapp.webp" alt="WhatsApp" loading="lazy" decoding="async" />
        </a>
        <a href="tel:+573042088961" rel="nofollow" aria-label="Llamar">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.02-.24c1.12.37 2.33.57 3.57.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1C10.07 21 3 13.93 3 5a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.24.2 2.45.57 3.57a1 1 0 0 1-.24 1.02l-2.2 2.2z"/>
          </svg>
        </a>
      </div>

      <div class="bar" role="search" aria-label="Buscar y filtrar productos">
        <div class="search-wrap" id="searchWrap">
          <div class="search-ticker" id="searchTicker" aria-hidden="true">
            <div class="ticker-inner" id="tickerInner"></div>
          </div>

          <input id="q" type="search" inputmode="search"
                 placeholder="üîç Buscar aqui, por nombre, marca, categor√≠a..."
                 aria-label="Buscar producto" />
        </div>

        <div class="count-slot" id="countSlot"></div>

        <select id="cat" aria-label="Filtrar por categor√≠a"><option value="">Todas las categor√≠as</option></select>
        <select id="brand" aria-label="Filtrar por marca"><option value="">Todas las marcas</option></select>
        <select id="sort" aria-label="Ordenar productos">
          <option value="">Ordenar</option>
          <option value="price_asc">Precio: menor a mayor</option>
          <option value="price_desc">Precio: mayor a mayor</option>
          <option value="name_asc">Nombre: A ‚Üí Z</option>
        </select>

        <button class="btn-acc" id="btn-cart" type="button" aria-label="Ver carrito WhatsApp">
          <span class="btn-cart-label">Ver carrito WhatsApp</span>
          <span class="btn-cart-label-short" aria-hidden="true">Carrito</span>
          <span id="cartCount" class="pill">0</span>
        </button>
      </div>

      <noscript>
        <div style="margin-top:12px;border:1px solid #22304a;border-radius:14px;padding:12px;background:rgba(18,24,38,.55);">
          <h2 style="margin:0 0 6px;font-size:16px;">Cat√°logo Natura en Santa Marta</h2>
          <p style="margin:0 0 8px;color:#a9b4c2;line-height:1.45;">
            Activa JavaScript para ver el cat√°logo completo.
          </p>
          <p style="margin:0;">
            <a href="https://wa.me/573042088961"
               rel="noopener noreferrer" target="_blank" style="font-weight:900;">
              Comprar por WhatsApp
            </a>
          </p>
        </div>
      </noscript>
    </div>
  </header>

  <main class="wrap">
    <div class="topline" id="topline">
      <div class="count" id="count" aria-live="polite">Cargando productos‚Ä¶</div>
    </div>
    <section id="grid" class="grid" aria-label="Productos"></section>
  </main>

  <div class="cart-modal" id="cartModal" aria-hidden="true" role="dialog" aria-label="Carrito">
    <div class="cart-modal-backdrop" id="cartModalBackdrop"></div>
    <div class="cart-modal-content" role="document" aria-label="Contenido del carrito">
      <div class="cart-modal-header">
        <h3 class="cart-modal-title">üõí Carrito</h3>
        <button class="cart-modal-close" id="cartModalClose" type="button" aria-label="Cerrar">‚úï</button>
      </div>
      <div class="cart-modal-body">
        <div id="cartItems"></div>
      </div>
      <div class="cart-modal-footer">
        <div class="cart-total" id="cartTotal">Total: $0</div>
        <div class="cart-footer-actions">
          <button class="btn-acc" id="cartBuyBtn" type="button">Comprar por WhatsApp</button>
        </div>
      </div>
    </div>
  </div>

  <div class="img-modal" id="imgModal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
    <div class="img-modal-backdrop" id="imgModalBackdrop"></div>
    <button class="img-modal-close" id="imgModalClose" type="button" aria-label="Cerrar">‚úï</button>
    <div class="img-modal-content" role="document">
      <img id="imgModalImg" alt="Imagen ampliada del producto" />
    </div>
  </div>

  <script>
    /* ==========================
       OPTIMIZACIONES + ESTRUCTURA
       - 2 carpetas dentro de /natura:
         1) logos
         2) imagenes_de_productos
       - ‚úÖ Nuevo: el suplente se elige desde INTERRUPTORES (nombre de archivo en /logos)
       - Si falla, usa cascada: suplente.webp -> suplente.png -> logo_empresa.png
       - Interruptor MOSTRAR_IMAGENES_PRODUCTO se mantiene
       - SITE_BASE autom√°tico: funciona en local y en GitHub Pages
       ========================== */

    const INTERRUPTORES = {
      MOSTRAR_CANTIDAD_STOCK: false,
      MOSTRAR_TEXTO_ESTADO_STOCK: false,
      HABILITAR_UBICACION_GPS: true,
      APLICAR_LIMITES_STOCK: false,

      /* true=mostrar fotos reales; false=usar siempre suplente */
      MOSTRAR_IMAGENES_PRODUCTO: true,

      /* ‚úÖ NUEVO:
         Nombre del archivo dentro de /logos que se usar√° como suplente.
         Ejemplos v√°lidos:
           "suplente.webp"
           "mi_logo.png"
           "mi_suplente"   (sin extensi√≥n: probar√° .webp y .png)
         Si lo dejas vac√≠o, se usa la cascada por defecto.
      */
      IMAGEN_SUPLENTE_PRODUCTO: "suplente.webp"
    };
    window.INTERRUPTORES = INTERRUPTORES;

    function shouldEnforceStockLimits(){
      return !!(window.INTERRUPTORES && window.INTERRUPTORES.APLICAR_LIMITES_STOCK === true);
    }

    function shouldShowProductImages(){
      return !!(window.INTERRUPTORES && window.INTERRUPTORES.MOSTRAR_IMAGENES_PRODUCTO !== false);
    }

    const _hasIdle = ("requestIdleCallback" in window);
    function runIdle(fn, timeout=1200){
      if(_hasIdle) return requestIdleCallback(fn, { timeout });
      return setTimeout(fn, Math.min(250, timeout));
    }

    const WHATSAPP_NUMBER = "573042088961";

    const IMG_DIR = "imagenes_de_productos";
    const LOGOS_DIR = "logos";

    const IMAGE_EXTS = ["webp","jpg","jpeg","png"];
    const NON_IMAGE_EXTS = ["txt"];
    const SUPPORTED_EXTS = [...IMAGE_EXTS, ...NON_IMAGE_EXTS];

    const fmtCOP = new Intl.NumberFormat("es-CO", { style:"currency", currency:"COP", maximumFractionDigits:0 });

    /* ‚úÖ BASE AUTOM√ÅTICA (local y producci√≥n) */
    const SITE_BASE = new URL("./", document.baseURI).href;

    /* Logo corporativo (respaldo final) */
    const COMPANY_LOGO = SITE_BASE + LOGOS_DIR + "/logo_empresa.png";

    function normalizeText(t){
      return (t || "")
        .toString()
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }
    function toNumberDigits(s){
      return Number(String(s ?? "").replace(/[^\d]/g,"")) || 0;
    }
    function safeInt(s, def=0){
      const n = parseInt(String(s ?? "").replace(/[^\d]/g,""), 10);
      return Number.isFinite(n) ? n : def;
    }
    function extOf(filename){
      const i = String(filename || "").lastIndexOf(".");
      if(i < 0) return "";
      return String(filename).slice(i+1).toLowerCase();
    }
    function baseOf(filename){
      const s = String(filename || "");
      const i = s.lastIndexOf(".");
      return (i < 0) ? s : s.slice(0, i);
    }
    function encodePath(p){
      return encodeURI(String(p || ""));
    }
    function isImageExt(ext){
      return IMAGE_EXTS.includes(String(ext || "").toLowerCase());
    }

    /* ==========================
       ‚úÖ NUEVO: suplente configurable en INTERRUPTORES
       - Acepta nombre con extensi√≥n o sin extensi√≥n.
       - Sanitiza para evitar rutas (solo nombre de archivo).
       - Luego aplica cascada por defecto.
       ========================== */
    function sanitizeLogoFilename(input){
      const raw = String(input || "").trim();
      if(!raw) return "";
      const just = raw.split(/[\/\\]/).pop(); // evita rutas
      if(!just || just.includes("..")) return "";
      return just.replace(/[^\w.\- ]+/g, "").trim();
    }

    function buildPlaceholderCandidates(){
      const list = [];
      const picked = sanitizeLogoFilename(window.INTERRUPTORES?.IMAGEN_SUPLENTE_PRODUCTO);

      if(picked){
        const e = extOf(picked);
        if(e){
          list.push(SITE_BASE + LOGOS_DIR + "/" + encodePath(picked));
        }else{
          list.push(SITE_BASE + LOGOS_DIR + "/" + encodePath(picked) + ".webp");
          list.push(SITE_BASE + LOGOS_DIR + "/" + encodePath(picked) + ".png");
        }
      }

      // cascada por defecto
      list.push(
        SITE_BASE + LOGOS_DIR + "/suplente.webp",
        SITE_BASE + LOGOS_DIR + "/suplente.png",
        COMPANY_LOGO
      );

      // de-dup
      return [...new Set(list)];
    }

    let PRODUCT_PLACEHOLDERS = buildPlaceholderCandidates();
    let PRODUCT_PLACEHOLDER_IMAGE = (PRODUCT_PLACEHOLDERS[0] || COMPANY_LOGO);

    function productPlaceholderAbsoluteUrl(){
      return PRODUCT_PLACEHOLDER_IMAGE || COMPANY_LOGO;
    }

    function productImageAbsoluteUrlFromFilename(filename){
      if(!shouldShowProductImages()){
        return productPlaceholderAbsoluteUrl();
      }
      if(!filename) return productPlaceholderAbsoluteUrl();
      return SITE_BASE + IMG_DIR + "/" + encodePath(filename);
    }

    async function fetchJson(url){
      const res = await fetch(url, {
        method:"GET",
        headers:{ "Accept":"application/vnd.github+json" },
        cache:"force-cache",
        credentials:"omit"
      });
      if(!res.ok){
        const text = await res.text().catch(()=> "");
        throw new Error("HTTP " + res.status + " " + (text || ""));
      }
      return await res.json();
    }

    /* ==========================
       Warm-up del placeholder (1 sola vez)
       - Prueba: (lo que diga INTERRUPTORES) -> suplente.webp -> suplente.png -> logo
       ========================== */
    function warmupPlaceholderOnce(){
      return new Promise((resolve)=>{
        try{
          PRODUCT_PLACEHOLDERS = buildPlaceholderCandidates();

          let i = 0;
          const tryNext = ()=>{
            if(i >= PRODUCT_PLACEHOLDERS.length){
              PRODUCT_PLACEHOLDER_IMAGE = COMPANY_LOGO;
              resolve();
              return;
            }

            const url = PRODUCT_PLACEHOLDERS[i++];
            const test = new Image();
            test.onload = ()=>{
              PRODUCT_PLACEHOLDER_IMAGE = url;
              resolve();
            };
            test.onerror = tryNext;
            test.decoding = "async";
            test.loading = "eager";
            test.src = url;
          };

          tryNext();
        }catch(_){
          PRODUCT_PLACEHOLDER_IMAGE = COMPANY_LOGO;
          resolve();
        }
      });
    }

    function parseProductFromBaseName(baseName){
      const parts = String(baseName || "").split("_");
      if(parts.length < 6) return null;

      const id = String(parts[0] || "").trim();
      const qty = safeInt(parts[parts.length - 1], 0);
      const price = toNumberDigits(parts[parts.length - 2]);
      const brand = String(parts[parts.length - 3] || "").trim();
      const category = String(parts[parts.length - 4] || "").trim();
      const name = String(parts.slice(1, parts.length - 4).join("_") || "").trim();

      if(!id || !name) return null;

      return {
        id,
        name,
        category,
        brand,
        price,
        stock: Math.max(0, qty),
        searchKey: normalizeText(`${name} ${brand} ${category} ${id}`)
      };
    }

    function preferredExtScore(ext){
      const order = { webp:0, jpg:1, jpeg:2, png:3 };
      return (ext in order) ? order[ext] : 99;
    }

    const GITHUB_OWNER = "irenismb";
    const GITHUB_REPO = "stock";
    const GITHUB_PRODUCTS_PATH = "natura/imagenes_de_productos";

    const PRODUCTS_CACHE_KEYS = ["irenismb_products_cache_v4", "irenismb_products_cache_v3"];
    const PRODUCTS_CACHE_TTL_MS = 30 * 60 * 1000;

    function readProductsCacheObj(){
      for(const key of PRODUCTS_CACHE_KEYS){
        try{
          const raw = localStorage.getItem(key);
          if(!raw) continue;
          const obj = JSON.parse(raw);
          if(!obj || typeof obj !== "object") continue;
          if(!Array.isArray(obj.products)) continue;
          if(!Number.isFinite(obj.ts)) continue;
          return obj;
        }catch(_){}
      }
      return null;
    }

    function readProductsCache(allowStale){
      const obj = readProductsCacheObj();
      if(!obj) return null;
      const age = Date.now() - obj.ts;
      const isFresh = age <= PRODUCTS_CACHE_TTL_MS;
      if(!allowStale && !isFresh) return null;
      return { products: obj.products, isFresh };
    }

    function writeProductsCache(products){
      try{
        localStorage.setItem(PRODUCTS_CACHE_KEYS[0], JSON.stringify({
          ts: Date.now(),
          products: products || []
        }));
      }catch(_){}
    }

    function pickBetterRepresentative(existing, candidate){
      if(!existing) return candidate;

      const eImg = !!existing.hasImage;
      const cImg = !!candidate.hasImage;

      if(eImg && !cImg) return existing;
      if(!eImg && cImg) return candidate;

      if(eImg && cImg){
        const eExt = String(existing.fileExt || extOf(existing.srcFilename || existing.imgFilename || "")).toLowerCase();
        const cExt = String(candidate.fileExt || extOf(candidate.srcFilename || candidate.imgFilename || "")).toLowerCase();
        if(preferredExtScore(cExt) < preferredExtScore(eExt)) return candidate;
        return existing;
      }
      return existing;
    }

    async function fetchProductsViaContentsApi(){
      const url = `https://api.github.com/repos/${encodeURIComponent(GITHUB_OWNER)}/${encodeURIComponent(GITHUB_REPO)}/contents/${GITHUB_PRODUCTS_PATH}`;
      const list = await fetchJson(url);
      if(!Array.isArray(list)) throw new Error("Respuesta inesperada de GitHub Contents.");

      const files = list
        .filter(x => x && x.type === "file" && typeof x.name === "string")
        .map(x => x.name)
        .filter(fn => fn && !fn.includes("/"));

      const byId = new Map();

      for(const filename of files){
        const ext = extOf(filename);
        if(!SUPPORTED_EXTS.includes(ext)) continue;

        const base = baseOf(filename);
        const parsed = parseProductFromBaseName(base);
        if(!parsed) continue;

        const hasImage = isImageExt(ext);
        const candidate = {
          ...parsed,
          srcFilename: filename,
          fileExt: ext,
          hasImage,
          imgFilename: hasImage ? filename : null
        };

        const existing = byId.get(parsed.id);
        byId.set(parsed.id, pickBetterRepresentative(existing, candidate));
      }

      const products = Array.from(byId.values())
        .sort((a,b)=> String(a.name||"").localeCompare(String(b.name||""), "es", { sensitivity:"base" }) || String(a.id).localeCompare(String(b.id)));

      return products;
    }

    async function fetchProductsViaTreeFallback(){
      const repoInfo = await fetchJson(`https://api.github.com/repos/${encodeURIComponent(GITHUB_OWNER)}/${encodeURIComponent(GITHUB_REPO)}`);
      const branch = String(repoInfo && repoInfo.default_branch ? repoInfo.default_branch : "main");
      const branchInfo = await fetchJson(`https://api.github.com/repos/${encodeURIComponent(GITHUB_OWNER)}/${encodeURIComponent(GITHUB_REPO)}/branches/${encodeURIComponent(branch)}`);
      const sha = branchInfo && branchInfo.commit && branchInfo.commit.sha ? branchInfo.commit.sha : "";
      if(!sha) throw new Error("No se pudo obtener el SHA del branch.");

      const tree = await fetchJson(`https://api.github.com/repos/${encodeURIComponent(GITHUB_OWNER)}/${encodeURIComponent(GITHUB_REPO)}/git/trees/${encodeURIComponent(sha)}?recursive=1`);
      const nodes = (tree && Array.isArray(tree.tree)) ? tree.tree : [];

      const dirPrefix = (GITHUB_PRODUCTS_PATH.replace(/\/+$/,"") + "/");
      const files = nodes
        .filter(n => n && n.type === "blob" && typeof n.path === "string" && n.path.startsWith(dirPrefix))
        .map(n => n.path.slice(dirPrefix.length))
        .filter(fn => fn && !fn.includes("/"));

      const byId = new Map();
      for(const filename of files){
        const ext = extOf(filename);
        if(!SUPPORTED_EXTS.includes(ext)) continue;
        const base = baseOf(filename);
        const parsed = parseProductFromBaseName(base);
        if(!parsed) continue;

        const hasImage = isImageExt(ext);
        const candidate = { ...parsed, srcFilename: filename, fileExt: ext, hasImage, imgFilename: hasImage ? filename : null };

        const existing = byId.get(parsed.id);
        byId.set(parsed.id, pickBetterRepresentative(existing, candidate));
      }

      return Array.from(byId.values())
        .sort((a,b)=> String(a.name||"").localeCompare(String(b.name||""), "es", { sensitivity:"base" }) || String(a.id).localeCompare(String(b.id)));
    }

    async function loadProductsFresh(){
      try{
        const products = await fetchProductsViaContentsApi();
        return products;
      }catch(_){
        return await fetchProductsViaTreeFallback();
      }
    }

    function isMobileDevice(){
      try{
        const ua = (navigator.userAgent || "").toLowerCase();
        const byUA = /android|iphone|ipad|ipod|iemobile|opera mini/.test(ua);
        const byPointer = window.matchMedia && window.matchMedia("(pointer:coarse)").matches;
        return Boolean(byUA || byPointer);
      }catch(_){
        return false;
      }
    }
    function waLink(text){
      const msg = String(text || "");
      if (isMobileDevice()){
        return `https://wa.me/${encodeURIComponent(WHATSAPP_NUMBER)}${msg ? `?text=${encodeURIComponent(msg)}` : ""}`;
      }
      return `https://web.whatsapp.com/send?phone=${encodeURIComponent(WHATSAPP_NUMBER)}${msg ? `&text=${encodeURIComponent(msg)}` : ""}`;
    }

    (function syncTopWhatsApp(){
      const a = document.getElementById("waTopLink");
      if (!a) return;
      a.href = waLink("");
      a.setAttribute("aria-label", isMobileDevice() ? "WhatsApp" : "WhatsApp Web");
    })();

    (function initAboutCollapse(){
      const card = document.getElementById("aboutCard");
      const btn = document.getElementById("aboutToggle");
      if(!card || !btn) return;
      const mq = window.matchMedia("(max-width:768px)");
      function setExpanded(expanded){
        card.classList.toggle("about-collapsed", !expanded);
        btn.setAttribute("aria-expanded", expanded ? "true" : "false");
        btn.textContent = expanded ? "Ver menos" : "Ver m√°s";
        card.dataset.expanded = expanded ? "1" : "0";
      }
      function apply(){
        if(mq.matches){
          btn.hidden = false;
          const expanded = (card.dataset.expanded === "1");
          setExpanded(expanded);
        }else{
          btn.hidden = true;
          card.classList.remove("about-collapsed");
        }
      }
      btn.addEventListener("click", ()=>{
        const expandedNow = (card.dataset.expanded === "1");
        setExpanded(!expandedNow);
      });
      if(typeof mq.addEventListener === "function"){
        mq.addEventListener("change", apply);
      }else if(typeof mq.addListener === "function"){
        mq.addListener(apply);
      }
      if(!card.dataset.expanded) card.dataset.expanded = "0";
      apply();
    })();

    const imgModal = document.getElementById("imgModal");
    const imgModalImg = document.getElementById("imgModalImg");
    const imgModalClose = document.getElementById("imgModalClose");
    const imgModalBackdrop = document.getElementById("imgModalBackdrop");

    function openImgModal(src, alt){
      if(!imgModal || !imgModalImg || !src) return;
      imgModalImg.src = src;
      imgModalImg.alt = alt || "Imagen ampliada del producto";
      imgModal.classList.add("open");
      imgModal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeImgModal(){
      if(!imgModal || !imgModalImg) return;
      imgModal.classList.remove("open");
      imgModal.setAttribute("aria-hidden","true");
      imgModalImg.src = "";
      document.body.style.overflow = "";
    }
    if(imgModalClose) imgModalClose.addEventListener("click", closeImgModal);
    if(imgModalBackdrop) imgModalBackdrop.addEventListener("click", closeImgModal);

    function makeImgFromFilename(filename, name){
      const img = document.createElement("img");
      img.alt = name ? ("Foto " + name) : "Foto del producto";
      img.loading = "lazy";
      img.decoding = "async";

      let zoomable = false;

      function setNonZoom(){
        zoomable = false;
        img.style.cursor = "default";
      }

      const allowReal = shouldShowProductImages() && Boolean(filename);

      if(!allowReal){
        img.src = productPlaceholderAbsoluteUrl();
        setNonZoom();
      }else{
        zoomable = true;
        img.src = productImageAbsoluteUrlFromFilename(filename);
      }

      img.onerror = ()=>{
        if(img.dataset.fallbackTried === "1"){
          img.onerror = null;
          img.src = COMPANY_LOGO;
          setNonZoom();
          return;
        }
        img.dataset.fallbackTried = "1";
        img.src = productPlaceholderAbsoluteUrl();
        setNonZoom();
      };

      img.addEventListener("click", ()=>{
        if(!zoomable) return;
        const src = img.currentSrc || img.src;
        if(src) openImgModal(src, img.alt);
      });

      return img;
    }

    function makeCartThumbFromFilename(filename, name){
      const img = document.createElement("img");
      img.className = "cart-thumb";
      img.alt = name ? ("Foto " + name) : "Foto del producto";
      img.loading = "lazy";
      img.decoding = "async";

      let zoomable = false;

      function setNonZoom(){
        zoomable = false;
        img.style.cursor = "default";
      }

      const allowReal = shouldShowProductImages() && Boolean(filename);

      if(!allowReal){
        img.src = productPlaceholderAbsoluteUrl();
        setNonZoom();
      }else{
        zoomable = true;
        img.src = productImageAbsoluteUrlFromFilename(filename);
      }

      img.onerror = ()=>{
        if(img.dataset.fallbackTried === "1"){
          img.onerror = null;
          img.src = COMPANY_LOGO;
          setNonZoom();
          return;
        }
        img.dataset.fallbackTried = "1";
        img.src = productPlaceholderAbsoluteUrl();
        setNonZoom();
      };

      img.addEventListener("click", ()=>{
        if(!zoomable) return;
        const src = img.currentSrc || img.src;
        if(src) openImgModal(src, img.alt);
      });

      return img;
    }

    let all = [];
    let productById = new Map();

    const cart = (() => {
      try{
        const rawCart = localStorage.getItem("cart");
        const parsed = JSON.parse(rawCart || "{}");
        return (parsed && typeof parsed === "object") ? parsed : {};
      }catch(_){
        localStorage.removeItem("cart");
        return {};
      }
    })();

    const cartCountEl = document.getElementById("cartCount");

    function cartItemsArray(){
      return Object.values(cart)
        .filter(it => it && it.qty > 0 && it.id && productById.has(String(it.id)));
    }
    function cartTotalValue(){
      return cartItemsArray().reduce((s,it)=> s + ((Number(it.price)||0) * (Number(it.qty)||0)), 0);
    }
    function cartTotalQty(){
      return cartItemsArray().reduce((s,it)=> s + (Number(it.qty)||0), 0);
    }
    function refreshCartCount(){
      if(!cartCountEl) return;
      const qty = cartTotalQty();
      cartCountEl.textContent = String(qty);
      cartCountEl.classList.toggle("has-items", qty > 0);
    }
    function saveCart(){
      localStorage.setItem("cart", JSON.stringify(cart));
      refreshCartCount();
    }

    function sanitizeCartWithStock(){
      const enforce = shouldEnforceStockLimits();
      let changed = false;

      for(const key of Object.keys(cart)){
        const it = cart[key];
        if(!it || !it.id){
          delete cart[key];
          changed = true;
          continue;
        }
        const id = String(it.id);
        const p = productById.get(id);
        if(!p){
          delete cart[key];
          changed = true;
          continue;
        }

        const maxStock = Number.isFinite(p.stock) ? p.stock : 0;
        const qty = Math.max(0, safeInt(it.qty, 0));

        const newQty = enforce
          ? ((maxStock > 0) ? Math.min(qty, maxStock) : 0)
          : qty;

        const newObj = {
          id: p.id,
          name: p.name,
          price: p.price,
          qty: newQty,
          stock: p.stock,
          imgFilename: p.imgFilename || null
        };

        cart[id] = newObj;
        if(id !== key) delete cart[key];

        if(newQty !== qty) changed = true;
      }

      if(changed) saveCart(); else refreshCartCount();
    }

    function cartMessage(){
      const items = cartItemsArray();
      if(!items.length) return "Hola, quiero informaci√≥n del cat√°logo.";
      const lines = items.map(it => `- ${it.name} (Id: ${it.id}) x${it.qty} = ${fmtCOP.format((Number(it.price)||0) * (Number(it.qty)||0))}`);
      const total = cartTotalValue();
      return `Hola, quiero comprar:\n${lines.join("\n")}\n\nTotal: ${fmtCOP.format(total)}`;
    }

    const cartModal = document.getElementById("cartModal");
    const cartModalClose = document.getElementById("cartModalClose");
    const cartModalBackdrop = document.getElementById("cartModalBackdrop");
    const cartItemsEl = document.getElementById("cartItems");
    const cartTotalEl = document.getElementById("cartTotal");
    const cartBuyBtn = document.getElementById("cartBuyBtn");

    function openCartModal(){
      renderCartModal();
      cartModal.classList.add("open");
      cartModal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }
    function closeCartModal(){
      cartModal.classList.remove("open");
      cartModal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    function renderCartModal(){
      const enforce = shouldEnforceStockLimits();
      const items = cartItemsArray();
      const total = cartTotalValue();
      cartTotalEl.textContent = "Total: " + fmtCOP.format(total);

      if(!items.length){
        cartItemsEl.innerHTML = `<div class="cart-empty">El carrito est√° vac√≠o. Agrega productos desde el cat√°logo.</div>`;
        return;
      }

      const frag = document.createDocumentFragment();
      items.forEach(it=>{
        const row = document.createElement("div");
        row.className = "cart-item";
        row.setAttribute("data-id", it.id);

        const left = document.createElement("div");
        left.className = "cart-item-left";

        const p = productById.get(String(it.id));
        const imgFilename = (p && p.imgFilename) ? p.imgFilename : it.imgFilename;

        left.appendChild(makeCartThumbFromFilename(imgFilename, it.name));

        const main = document.createElement("div");
        main.className = "cart-item-main";
        main.innerHTML = `
          <p class="cart-item-name"></p>
          <p class="cart-item-sub"></p>
        `;
        main.querySelector(".cart-item-name").textContent = it.name;
        main.querySelector(".cart-item-sub").textContent = `Id: ${it.id} ¬∑ Precio: ${fmtCOP.format(Number(it.price)||0)}`;
        left.appendChild(main);

        const controls = document.createElement("div");
        controls.className = "cart-controls";
        controls.innerHTML = `
          <button class="cart-qty-btn" type="button" data-act="dec" aria-label="Disminuir">‚àí</button>
          <span class="cart-qty" aria-label="Cantidad">${it.qty}</span>
          <button class="cart-qty-btn" type="button" data-act="inc" aria-label="Aumentar">+</button>
        `;

        const incBtn = controls.querySelector('button[data-act="inc"]');
        const maxStock = Number.isFinite(it.stock) ? it.stock : 0;

        if(incBtn){
          incBtn.disabled = enforce ? (!(maxStock > 0) || (Number(it.qty)||0) >= maxStock) : false;
        }

        const subtotal = document.createElement("div");
        subtotal.className = "cart-subtotal";
        subtotal.textContent = fmtCOP.format((Number(it.price)||0) * (Number(it.qty)||0));

        const remove = document.createElement("button");
        remove.className = "cart-remove";
        remove.type = "button";
        remove.textContent = "Eliminar";
        remove.setAttribute("data-act", "remove");

        row.appendChild(left);
        row.appendChild(controls);
        row.appendChild(subtotal);
        row.appendChild(remove);
        frag.appendChild(row);
      });

      cartItemsEl.innerHTML = "";
      cartItemsEl.appendChild(frag);
    }

    cartItemsEl.addEventListener("click", (e)=>{
      const btn = e.target.closest("button");
      if(!btn) return;
      const itemRow = e.target.closest(".cart-item");
      if(!itemRow) return;
      const id = itemRow.getAttribute("data-id");
      if(!id || !cart[id]) return;

      const enforce = shouldEnforceStockLimits();
      const act = btn.getAttribute("data-act");
      const current = cart[id];

      const maxStock = Number.isFinite(current.stock) ? current.stock : 0;
      let newQty = safeInt(current.qty, 0);

      if(act === "inc"){
        if(!enforce){
          newQty += 1;
        }else{
          if(maxStock > 0 && newQty < maxStock) newQty += 1;
        }
      }
      if(act === "dec"){
        newQty = Math.max(0, newQty - 1);
      }
      if(act === "remove"){
        newQty = 0;
      }

      if(!newQty) delete cart[id];
      else cart[id].qty = newQty;

      saveCart();
      renderCartModal();
    });

    cartBuyBtn.addEventListener("click", ()=>{
      const items = cartItemsArray();
      window.open(waLink(items.length ? cartMessage() : "Hola, quiero informaci√≥n del cat√°logo."), "_blank", "noopener");
    });

    cartModalClose.addEventListener("click", closeCartModal);
    cartModalBackdrop.addEventListener("click", closeCartModal);

    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        if(imgModal && imgModal.classList.contains("open")) closeImgModal();
        if(cartModal && cartModal.classList.contains("open")) closeCartModal();
      }
    });

    const catSel = document.getElementById("cat");
    const brandSel = document.getElementById("brand");
    const sortSel = document.getElementById("sort");
    const qInp = document.getElementById("q");
    const grid = document.getElementById("grid");
    const countEl = document.getElementById("count");

    const searchWrap = document.getElementById("searchWrap");
    const searchTicker = document.getElementById("searchTicker");
    const tickerInner = document.getElementById("tickerInner");

    const countSlot = document.getElementById("countSlot");
    const topline = document.getElementById("topline");
    const mqCountMobile = window.matchMedia("(max-width:560px)");

    function placeCountElement(){
      if(!countEl || !countSlot || !topline) return;

      if(mqCountMobile.matches){
        if(countEl.parentElement !== countSlot){
          countSlot.appendChild(countEl);
        }
        countEl.classList.add("count-mobile");
        topline.classList.add("hidden");
      }else{
        if(countEl.parentElement !== topline){
          topline.appendChild(countEl);
        }
        countEl.classList.remove("count-mobile");
        topline.classList.remove("hidden");
      }
    }

    if(typeof mqCountMobile.addEventListener === "function"){
      mqCountMobile.addEventListener("change", placeCountElement);
    }else if(typeof mqCountMobile.addListener === "function"){
      mqCountMobile.addListener(placeCountElement);
    }
    placeCountElement();

    function updateTickerVisibility(){
      if(!searchWrap || !qInp) return;
      const empty = !String(qInp.value || "").trim();
      const focused = (document.activeElement === qInp);
      searchWrap.classList.toggle("show-ticker", empty && !focused);
    }

    function updateCountAttention(){
      if(!countEl || !qInp) return;
      const hasQuery = !!String(qInp.value || "").trim();
      countEl.classList.toggle("search-active", hasQuery);
    }

    function rebuildSearchTicker(){
      if(!searchWrap || !searchTicker || !tickerInner || !qInp) return;

      const text = String(qInp.getAttribute("placeholder") || "").trim();
      if(!text){
        tickerInner.innerHTML = "";
        searchWrap.style.setProperty("--marquee-distance", "0px");
        return;
      }

      tickerInner.innerHTML = "";

      const seq = document.createElement("div");
      seq.className = "ticker-seq";
      tickerInner.appendChild(seq);

      const available = Math.max(1, searchTicker.clientWidth || searchWrap.clientWidth || 1);
      const target = Math.max(280, Math.floor(available * 1.7));

      let guard = 0;
      while(seq.scrollWidth < target && guard < 60){
        const item = document.createElement("span");
        item.className = "ticker-item";
        item.textContent = text;
        seq.appendChild(item);
        guard++;
      }

      const seqWidth = seq.scrollWidth || 0;
      if(seqWidth <= 0) return;

      const clone = seq.cloneNode(true);
      tickerInner.appendChild(clone);

      const SPEED_PX_PER_SEC = 60;
      const duration = Math.max(8, seqWidth / SPEED_PX_PER_SEC);

      searchWrap.style.setProperty("--marquee-distance", seqWidth + "px");
      searchWrap.style.setProperty("--marquee-duration", duration.toFixed(2) + "s");
    }

    function clearSelectButKeepFirst(sel){
      const first = sel.querySelector("option[value='']");
      sel.innerHTML = "";
      if(first) sel.appendChild(first);
      else{
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = (sel === catSel) ? "Todas las categor√≠as" : "Todas las marcas";
        sel.appendChild(opt);
      }
    }

    function fillSelect(sel, values){
      clearSelectButKeepFirst(sel);
      for(const v of values){
        const opt = document.createElement("option");
        opt.value = v; opt.textContent = v;
        sel.appendChild(opt);
      }
    }

    function readStateFromUrl(){
      const u = new URL(location.href);
      const q = (u.searchParams.get("q") || "").trim();
      const cat = (u.searchParams.get("cat") || "").trim();
      const br = (u.searchParams.get("brand") || "").trim();
      const sort = (u.searchParams.get("sort") || "").trim();
      if (q) qInp.value = q;
      if (cat) catSel.value = cat;
      if (br) brandSel.value = br;
      if (sort && sortSel) sortSel.value = sort;
    }

    let _urlTimer = null;
    function writeStateToUrl(){
      const u = new URL(location.href);
      const q = qInp.value.trim();
      const cat = catSel.value;
      const br = brandSel.value;
      const sort = sortSel ? sortSel.value : "";
      if (q) u.searchParams.set("q", q); else u.searchParams.delete("q");
      if (cat) u.searchParams.set("cat", cat); else u.searchParams.delete("cat");
      if (br) u.searchParams.set("brand", br); else u.searchParams.delete("brand");
      if (sort) u.searchParams.set("sort", sort); else u.searchParams.delete("sort");
      history.replaceState(null, "", u.toString());
    }
    function scheduleWriteStateToUrl(){
      clearTimeout(_urlTimer);
      _urlTimer = setTimeout(writeStateToUrl, 180);
    }

    let _ldJob = 0;
    function updateProductsJsonLd(list){
      try{
        const baseUrl = "https://irenismb.github.io/stock/natura/catalogo.html";
        const itemList = {
          "@context":"https://schema.org",
          "@type":"ItemList",
          "name":"Cat√°logo de productos",
          "itemListElement": list.slice(0, 500).map((p, i) => {
            const productUrl = baseUrl + "#p-" + encodeURIComponent(p.id);
            const imgUrl = productImageAbsoluteUrlFromFilename(p.imgFilename);
            const desc = `Producto: ${p.name}. Categor√≠a: ${p.category || "Natura"}. Compra por WhatsApp.`;
            const availability = (Number.isFinite(p.stock) && p.stock > 0)
              ? "https://schema.org/InStock"
              : "https://schema.org/OutOfStock";
            return {
              "@type":"ListItem",
              "position": i + 1,
              "url": productUrl,
              "item": {
                "@type":"Product",
                "name": p.name,
                "description": desc,
                "image": [imgUrl],
                "category": p.category || undefined,
                "brand": p.brand ? { "@type":"Brand", "name": p.brand } : undefined,
                "sku": String(p.id),
                "url": productUrl,
                "offers": {
                  "@type":"Offer",
                  "url": productUrl,
                  "priceCurrency":"COP",
                  "price": p.price || 0,
                  "availability": availability
                }
              }
            };
          })
        };
        const el = document.getElementById("ld-products");
        if(el) el.textContent = JSON.stringify(itemList);
      }catch(_){}
    }

    function scheduleJsonLdUpdate(filtered){
      const job = ++_ldJob;
      runIdle(()=>{
        if(job !== _ldJob) return;
        updateProductsJsonLd(filtered);
      }, 1400);
    }

    const cardTemplate = document.createElement("template");
    cardTemplate.innerHTML = `
      <article class="card">
        <div class="img"></div>
        <div class="pad">
          <h3 class="name"></h3>
          <p class="meta"></p>
          <div class="row">
            <span class="price"></span>
            <span class="pill" data-role="qty"></span>
          </div>
          <div class="actions">
            <button type="button" class="btn-danger" data-act="dec">Quitar</button>
            <button type="button" class="btn-acc" data-act="inc">Agregar</button>
          </div>
        </div>
      </article>
    `;

    function stockMetaText(p){
      const stockVal = Number.isFinite(p.stock) ? p.stock : 0;
      let stockPart = "";
      if (INTERRUPTORES.MOSTRAR_CANTIDAD_STOCK){
        stockPart = ` ¬∑ Stock: ${stockVal}`;
      } else if (INTERRUPTORES.MOSTRAR_TEXTO_ESTADO_STOCK){
        stockPart = ` ¬∑ ${stockVal > 0 ? "Disponible" : "Sin stock"}`;
      } else {
        stockPart = "";
      }
      return `${p.category} ¬∑ ${p.brand} ¬∑ Id: ${p.id}${stockPart}`;
    }

    function refreshCardUI(card, p){
      const enforce = shouldEnforceStockLimits();
      const id = String(p.id);
      const q = (cart[id]?.qty || 0);

      const qtyPill = card.querySelector('[data-role="qty"]');
      const decBtn = card.querySelector('button[data-act="dec"]');
      const incBtn = card.querySelector('button[data-act="inc"]');

      if(qtyPill) qtyPill.textContent = `En carrito: ${q}`;
      if(decBtn) decBtn.disabled = q <= 0;

      const maxStock = Number.isFinite(p.stock) ? p.stock : 0;
      const canAdd = !enforce ? true : ((maxStock > 0) && (q < maxStock));

      if(incBtn){
        incBtn.disabled = !canAdd;
        incBtn.classList.toggle("in-cart", q > 0);
        if(enforce && maxStock <= 0){
          incBtn.textContent = INTERRUPTORES.MOSTRAR_TEXTO_ESTADO_STOCK ? "Sin stock" : "Agregar";
        }else{
          incBtn.textContent = "Agregar";
        }
      }
    }

    function makeCard(p){
      const card = cardTemplate.content.firstElementChild.cloneNode(true);
      card.id = "p-" + p.id;
      card.dataset.id = String(p.id);

      const imgBox = card.querySelector(".img");
      imgBox.appendChild(makeImgFromFilename(p.imgFilename, p.name));

      const nameEl = card.querySelector(".name");
      const metaEl = card.querySelector(".meta");

      nameEl.textContent = p.name;
      metaEl.textContent = stockMetaText(p);

      /* ‚úÖ √∫til cuando hay clamp: tooltip con el texto completo */
      nameEl.title = p.name;
      metaEl.title = metaEl.textContent;

      card.querySelector(".price").textContent = fmtCOP.format(p.price);

      refreshCardUI(card, p);
      return card;
    }

    grid.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-act]");
      if(!btn) return;
      const card = e.target.closest(".card");
      if(!card) return;
      const id = card.dataset.id;
      if(!id) return;

      const p = productById.get(String(id));
      if(!p) return;

      const act = btn.getAttribute("data-act");
      const enforce = shouldEnforceStockLimits();

      if(act === "inc"){
        const maxStock = Number.isFinite(p.stock) ? p.stock : 0;
        const currentQty = safeInt(cart[id]?.qty, 0);

        if(enforce){
          if(!(maxStock > 0) || currentQty >= maxStock){
            refreshCardUI(card, p);
            return;
          }
        }

        const cur = cart[id] || { id:p.id, name:p.name, price:p.price, qty:0, stock:p.stock, imgFilename:p.imgFilename || null };
        cur.qty = safeInt(cur.qty, 0) + 1;
        cur.stock = p.stock;
        cur.name = p.name;
        cur.price = p.price;
        cur.imgFilename = p.imgFilename || null;
        cart[id] = cur;

        saveCart();
        refreshCardUI(card, p);

        btn.textContent = "Agregado ‚úì";
        setTimeout(()=> refreshCardUI(card, p), 900);

        if(cartModal.classList.contains("open")) renderCartModal();
        return;
      }

      if(act === "dec"){
        const cur = cart[id];
        if(!cur) return;

        cur.qty = Math.max(0, safeInt(cur.qty, 0) - 1);
        if(!cur.qty) delete cart[id];
        else cart[id] = cur;

        saveCart();
        refreshCardUI(card, p);

        btn.textContent = "Quitado ‚úì";
        setTimeout(()=> refreshCardUI(card, p), 900);

        if(cartModal.classList.contains("open")) renderCartModal();
        return;
      }
    });

    function buildFilteredList(){
      const cat = catSel.value;
      const br = brandSel.value;
      const sortMode = sortSel ? sortSel.value : "";
      const terms = normalizeText(qInp.value).split(/\s+/).filter(Boolean);

      let filtered = all.filter(p=>{
        if(cat && p.category !== cat) return false;
        if(br && p.brand !== br) return false;
        if(terms.length){
          return terms.every(t => p.searchKey.includes(t));
        }
        return true;
      });

      if(sortMode === "price_asc"){
        filtered.sort((a,b)=> (a.price||0) - (b.price||0) || String(a.id).localeCompare(String(b.id)));
      }else if(sortMode === "price_desc"){
        filtered.sort((a,b)=> (b.price||0) - (a.price||0) || String(a.id).localeCompare(String(b.id)));
      }else if(sortMode === "name_asc"){
        filtered.sort((a,b)=>{
          const cmp = String(a.name||"").localeCompare(String(b.name||""), "es", { sensitivity:"base" });
          if(cmp !== 0) return cmp;
          return String(a.id).localeCompare(String(b.id));
        });
      }
      return filtered;
    }

    let _renderToken = 0;
    function render(){
      const token = ++_renderToken;
      const filtered = buildFilteredList();

      const cat = catSel.value;
      const br = brandSel.value;
      const sortMode = sortSel ? sortSel.value : "";
      const qTxt = String(qInp.value || "").trim();
      const hasFilters = !!qTxt || !!cat || !!br || !!sortMode;

      if(filtered.length === 0){
        countEl.textContent = hasFilters
          ? "0 producto(s) encontrado(s). No encontr√© coincidencias; prueba con otra b√∫squeda."
          : "0 producto(s) disponible(s).";
      }else{
        countEl.textContent = hasFilters
          ? `Se encontraron ${filtered.length} producto(s). Los filtr√© abajo ‚¨áÔ∏è`
          : `Hay ${filtered.length} producto(s) disponible(s).`;
      }

      updateCountAttention();
      placeCountElement();

      grid.textContent = "";

      const CHUNK = 60;
      let i = 0;

      function drawChunk(){
        if(token !== _renderToken) return;

        const frag = document.createDocumentFragment();
        const end = Math.min(i + CHUNK, filtered.length);
        for(; i < end; i++){
          frag.appendChild(makeCard(filtered[i]));
        }
        grid.appendChild(frag);

        if(i < filtered.length){
          requestAnimationFrame(drawChunk);
        }
      }
      drawChunk();

      scheduleWriteStateToUrl();
      scheduleJsonLdUpdate(filtered);
    }

    document.getElementById("btn-cart").onclick = openCartModal;

    let _qTimer = null;
    qInp.addEventListener("input", ()=>{
      updateTickerVisibility();
      updateCountAttention();

      clearTimeout(_qTimer);
      _qTimer = setTimeout(render, 70);
    });

    catSel.addEventListener("change", render);
    brandSel.addEventListener("change", render);
    if(sortSel) sortSel.addEventListener("change", render);

    runIdle(()=>{
      updateTickerVisibility();
      rebuildSearchTicker();

      qInp.addEventListener("focus", updateTickerVisibility);
      qInp.addEventListener("blur", updateTickerVisibility);

      let raf = null;
      window.addEventListener("resize", ()=>{
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=>{
          rebuildSearchTicker();
          placeCountElement();
        });
      });
    }, 1000);

    function bootstrapFromProducts(products){
      all = products || [];
      productById = new Map(all.map(p => [String(p.id), p]));

      const cats = [...new Set(all.map(p=>p.category).filter(Boolean))].sort((a,b)=>a.localeCompare(b,"es",{sensitivity:"base"}));
      const brands = [...new Set(all.map(p=>p.brand).filter(Boolean))].sort((a,b)=>a.localeCompare(b,"es",{sensitivity:"base"}));
      fillSelect(catSel, cats);
      fillSelect(brandSel, brands);

      readStateFromUrl();
      sanitizeCartWithStock();
      refreshCartCount();

      updateCountAttention();
      placeCountElement();

      render();
    }

    async function init(){
      try{
        countEl.textContent = "Cargando productos‚Ä¶";

        const placeholderWarm = warmupPlaceholderOnce();

        const cached = readProductsCache(true);
        if(cached && cached.products && cached.products.length){
          bootstrapFromProducts(cached.products);

          placeholderWarm.then(()=> {
            if(all && all.length) {
              render();
              if(cartModal.classList.contains("open")) renderCartModal();
            }
          });

          runIdle(async ()=>{
            try{
              const fresh = await loadProductsFresh();
              writeProductsCache(fresh);
              bootstrapFromProducts(fresh);
            }catch(_){}
          }, cached.isFresh ? 2500 : 1200);

          return;
        }

        await placeholderWarm;
        const fresh = await loadProductsFresh();
        writeProductsCache(fresh);
        bootstrapFromProducts(fresh);

      }catch(_){
        countEl.textContent = "No se pudo cargar el cat√°logo. Verifica tu conexi√≥n e intenta recargar.";
        grid.innerHTML = "";
        refreshCartCount();
        updateCountAttention();
        placeCountElement();
      }
    }

    init();
  </script>

  <script>
    const LOCATION_MODE = "LOAD";
    const LOCATION_LOG_INTERVAL_MINUTES = 1;

    const LOCATION_LOG_ENDPOINT = "https://script.google.com/macros/s/AKfycbygXijUyDrpyeA8qmheyZpYw9HVWuN_JZPIeYNbqRKKNYhqFFUguEMZmof4yLTtGbVO/exec";

    (function(){
      if (window.INTERRUPTORES && window.INTERRUPTORES.HABILITAR_UBICACION_GPS === false){
        return;
      }

      function startTracking(){
        const intervalMs = Math.max(1, Number(LOCATION_LOG_INTERVAL_MINUTES) || 5) * 60 * 1000;
        let timerId = null;

        const LOAD_ID = (Date.now() + "-" + Math.random().toString(16).slice(2));
        const USER_ID_KEY = "irenismb_user_id";

        function getUserId(){
          try{
            let id = localStorage.getItem(USER_ID_KEY);
            if(id) return id;

            id = (window.crypto && typeof window.crypto.randomUUID === "function")
              ? window.crypto.randomUUID()
              : (Date.now() + "-" + Math.random().toString(16).slice(2));

            localStorage.setItem(USER_ID_KEY, id);
            return id;
          }catch(_){
            return (Date.now() + "-" + Math.random().toString(16).slice(2));
          }
        }

        const USER_ID = getUserId();
        let loggedNoGeo = false;

        function canGeo(){
          return ("geolocation" in navigator);
        }

        function guessFuenteFromAccuracy(acc){
          const a = Number(acc);
          if(!isFinite(a)) return "GEO";
          if(a <= 35) return "GPS";
          if(a <= 120) return "WI-FI";
          if(a <= 1000) return "CELULAR";
          return "GEO";
        }

        function sendLog(params){
          try{
            const lat = (params && params.lat != null) ? params.lat : "";
            const lng = (params && params.lng != null) ? params.lng : "";
            const acc = (params && params.acc != null) ? params.acc : "";
            const fuente = (params && params.fuente) ? String(params.fuente) : "";

            const payload = new URLSearchParams({
              lat: String(lat),
              lng: String(lng),
              acc: acc === "" ? "" : String(acc),

              fuente: fuente,
              src: fuente,

              navegador: USER_ID,
              user_id: USER_ID,

              load_id: LOAD_ID,
              mode: String(LOCATION_MODE || ""),
              ts: String(Date.now()),
              cb: Math.random().toString(36).slice(2)
            });

            const url = LOCATION_LOG_ENDPOINT + "?" + payload.toString();

            if (navigator.sendBeacon){
              try{
                const blob = new Blob([], { type: "text/plain" });
                navigator.sendBeacon(url, blob);
                return;
              }catch(_){}
            }

            fetch(url, {
              method: "GET",
              mode: "no-cors",
              cache: "no-store",
              keepalive: true
            }).catch(()=>{
              try{
                const img = new Image();
                img.src = url;
              }catch(_){}
            });

          }catch(_){}
        }

        function logNoGeoOnce(){
          if(loggedNoGeo) return;
          loggedNoGeo = true;
          sendLog({ lat:"", lng:"", acc:"", fuente:"SIN_UBICACION" });
        }

        function stopTimer(){
          if(timerId){
            clearInterval(timerId);
            timerId = null;
          }
        }

        function logOnce(){
          try{
            if(!canGeo()){
              logNoGeoOnce();
              return;
            }

            navigator.geolocation.getCurrentPosition(
              (pos)=>{
                const c = pos && pos.coords;
                if(!c){ logNoGeoOnce(); return; }

                sendLog({
                  lat: c.latitude,
                  lng: c.longitude,
                  acc: c.accuracy,
                  fuente: guessFuenteFromAccuracy(c.accuracy)
                });
              },
              (err)=>{
                if(err && err.code === 1){
                  logNoGeoOnce();
                  stopTimer();
                }
              },
              { enableHighAccuracy:true, timeout:30000, maximumAge: 0 }
            );

          }catch(_){}
        }

        function startAccordingMode(){
          const m = String(LOCATION_MODE || "").toUpperCase();
          if (m === "LOAD"){
            logOnce();
          }else{
            logOnce();
            if(!timerId) timerId = setInterval(logOnce, intervalMs);
          }
        }

        startAccordingMode();
      }

      const _hasIdle = ("requestIdleCallback" in window);
      const runIdle = (fn, timeout=1500)=> _hasIdle ? requestIdleCallback(fn, {timeout}) : setTimeout(fn, Math.min(350, timeout));

      if (document.readyState === "loading"){
        document.addEventListener("DOMContentLoaded", ()=> runIdle(startTracking, 1600), { once:true });
      }else{
        runIdle(startTracking, 1600);
      }
    })();
  </script>
</body>
</html>
